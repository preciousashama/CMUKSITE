(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{5248:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return n(1071)}])},1071:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return CheckoutPage}});var r=n(5893),i=n(7294),a=n(1163);function CheckoutPage(){let e=(0,a.useRouter)(),[t,n]=(0,i.useState)("shipping"),[s,d]=(0,i.useState)({shipping:{},payment:{},items:[],total:0}),[l,c]=(0,i.useState)(null),[o,p]=(0,i.useState)(null),[u,h]=(0,i.useState)("");(0,i.useEffect)(()=>{if(!CartManager.cart.length){e.push("/cart");return}if(d(e=>({...e,items:CartManager.cart,total:CartManager.calculateTotal()})),window.Stripe){let e=window.Stripe("pk_live_51Qr2StKg0noSfYuQGP6qNLoemAXaMiwaZZfcDfuAtcrq4h5RUlpuzkBE7HbdNa5XnqXaS44C6tiEvVtht9eBiLH500uVeNF7Je");c(e);let t=e.elements(),n=t.create("card");n.mount("#card-element"),p(n),n.on("change",e=>{h(e.error?e.error.message:"")})}},[e]);let handlePaymentSubmit=async e=>{if(e.preventDefault(),h(""),!l||!o){h("Payment is not ready yet.");return}let t=e.target,r=t["card-name"].value.trim();if(!r){h("Please enter the name on card.");return}let i=1.08*s.total;try{let e=await fetch("/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:Math.round(100*i)})}),t=await e.json();if(t.error){h(t.error);return}let a=await l.confirmCardPayment(t.clientSecret,{payment_method:{card:o,billing_details:{name:r}}});a.error?h(a.error.message):"succeeded"===a.paymentIntent.status&&(d(e=>{var t,n;return{...e,payment:{cardName:r,cardNumber:"**** **** **** "+((null===(n=a.paymentIntent.payment_method)||void 0===n?void 0:null===(t=n.card)||void 0===t?void 0:t.last4)||"****"),expiry:"N/A"}}}),n("review"))}catch(e){console.error(e),h("Payment failed. Please try again.")}};return(0,r.jsxs)("main",{children:["shipping"===t&&(0,r.jsx)("form",{id:"shipping-form",onSubmit:e=>{e.preventDefault();let t=e.target,r={fullName:t["full-name"].value,address:t.address.value,city:t.city.value,state:t.state.value,zip:t.zip.value,country:t.country.value,phone:t.phone.value};d(e=>({...e,shipping:r})),n("payment")},children:(0,r.jsx)("button",{type:"submit",children:"Continue to Payment"})}),"payment"===t&&(0,r.jsxs)("form",{id:"payment-form",onSubmit:handlePaymentSubmit,children:[(0,r.jsx)("input",{id:"card-name",name:"card-name",type:"text",placeholder:"Name on Card",required:!0}),(0,r.jsx)("div",{id:"card-element"}),u&&(0,r.jsx)("div",{style:{color:"red"},children:u}),(0,r.jsx)("button",{type:"button",onClick:()=>n("shipping"),children:"Back to Shipping"}),(0,r.jsx)("button",{type:"submit",children:"Continue to Review"})]}),"review"===t&&(0,r.jsxs)("section",{id:"order-review",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"Shipping Address"}),(0,r.jsx)("p",{children:s.shipping.fullName}),(0,r.jsx)("p",{children:s.shipping.address}),(0,r.jsxs)("p",{children:[s.shipping.city,", ",s.shipping.state," ",s.shipping.zip]}),(0,r.jsx)("p",{children:s.shipping.country}),(0,r.jsxs)("p",{children:["Phone: ",s.shipping.phone]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"Payment Method"}),(0,r.jsxs)("p",{children:["Credit Card ending in ",s.payment.cardNumber.slice(-4)]}),(0,r.jsxs)("p",{children:["Expiration: ",s.payment.expiry]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"Order Items"}),s.items.map((e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("img",{src:e.product.image,alt:e.product.name,width:50}),(0,r.jsx)("p",{children:e.product.name}),(0,r.jsxs)("p",{children:["Quantity: ",e.quantity]}),(0,r.jsxs)("p",{children:["Price: $",e.product.price.toFixed(2)]}),(0,r.jsxs)("p",{children:["Subtotal: $",(e.product.price*e.quantity).toFixed(2)]})]},t))]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"Order Summary"}),(0,r.jsxs)("p",{children:["Subtotal: $",s.total.toFixed(2)]}),(0,r.jsx)("p",{children:"Shipping: Free"}),(0,r.jsxs)("p",{children:["Tax: $",(.08*s.total).toFixed(2)]}),(0,r.jsxs)("p",{children:["Total: $",(1.08*s.total).toFixed(2)]})]}),(0,r.jsx)("button",{onClick:()=>n("payment"),children:"Back to Payment"}),(0,r.jsx)("button",{onClick:()=>{let t=OrderManager.createOrder({items:s.items,shipping:s.shipping,payment:{cardName:s.payment.cardName,lastFour:s.payment.cardNumber.slice(-4),expiry:s.payment.expiry},total:1.08*s.total});CartManager.clearCart(),sessionStorage.setItem("lastOrderId",t.id),e.push("/order-confirmation")},children:"Place Order"})]})]})}},1163:function(e,t,n){e.exports=n(9974)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=5248)}),_N_E=e.O()}]);