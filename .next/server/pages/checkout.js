(()=>{var e={};e.id=222,e.ids=[222,888,660],e.modules={2962:(e,t,r)=>{"use strict";r.r(t),r.d(t,{config:()=>y,default:()=>m,getServerSideProps:()=>g,getStaticPaths:()=>x,getStaticProps:()=>h,reportWebVitals:()=>S,routeModule:()=>_,unstable_getServerProps:()=>b,unstable_getServerSideProps:()=>f,unstable_getStaticParams:()=>P,unstable_getStaticPaths:()=>v,unstable_getStaticProps:()=>j});var i={};r.r(i),r.d(i,{default:()=>CheckoutPage});var a=r(7093),n=r(5244),s=r(1323),l=r(9209),p=r.n(l),c=r(9597),d=r(997),o=r(6689),u=r(1163);function CheckoutPage(){let e=(0,u.useRouter)(),[t,r]=(0,o.useState)("shipping"),[i,a]=(0,o.useState)({shipping:{},payment:{},items:[],total:0}),[n,s]=(0,o.useState)(null),[l,p]=(0,o.useState)(null),[c,m]=(0,o.useState)("");(0,o.useEffect)(()=>{if(!CartManager.cart.length){e.push("/cart");return}if(a(e=>({...e,items:CartManager.cart,total:CartManager.calculateTotal()})),window.Stripe){let e=window.Stripe("pk_live_51Qr2StKg0noSfYuQGP6qNLoemAXaMiwaZZfcDfuAtcrq4h5RUlpuzkBE7HbdNa5XnqXaS44C6tiEvVtht9eBiLH500uVeNF7Je");s(e);let t=e.elements(),r=t.create("card");r.mount("#card-element"),p(r),r.on("change",e=>{m(e.error?e.error.message:"")})}},[e]);let handlePaymentSubmit=async e=>{if(e.preventDefault(),m(""),!n||!l){m("Payment is not ready yet.");return}let t=e.target,s=t["card-name"].value.trim();if(!s){m("Please enter the name on card.");return}let p=1.08*i.total;try{let e=await fetch("/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:Math.round(100*p)})}),t=await e.json();if(t.error){m(t.error);return}let i=await n.confirmCardPayment(t.clientSecret,{payment_method:{card:l,billing_details:{name:s}}});i.error?m(i.error.message):"succeeded"===i.paymentIntent.status&&(a(e=>({...e,payment:{cardName:s,cardNumber:"**** **** **** "+(i.paymentIntent.payment_method?.card?.last4||"****"),expiry:"N/A"}})),r("review"))}catch(e){console.error(e),m("Payment failed. Please try again.")}};return(0,d.jsxs)("main",{children:["shipping"===t&&d.jsx("form",{id:"shipping-form",onSubmit:e=>{e.preventDefault();let t=e.target,i={fullName:t["full-name"].value,address:t.address.value,city:t.city.value,state:t.state.value,zip:t.zip.value,country:t.country.value,phone:t.phone.value};a(e=>({...e,shipping:i})),r("payment")},children:d.jsx("button",{type:"submit",children:"Continue to Payment"})}),"payment"===t&&(0,d.jsxs)("form",{id:"payment-form",onSubmit:handlePaymentSubmit,children:[d.jsx("input",{id:"card-name",name:"card-name",type:"text",placeholder:"Name on Card",required:!0}),d.jsx("div",{id:"card-element"}),c&&d.jsx("div",{style:{color:"red"},children:c}),d.jsx("button",{type:"button",onClick:()=>r("shipping"),children:"Back to Shipping"}),d.jsx("button",{type:"submit",children:"Continue to Review"})]}),"review"===t&&(0,d.jsxs)("section",{id:"order-review",children:[(0,d.jsxs)("div",{children:[d.jsx("h3",{children:"Shipping Address"}),d.jsx("p",{children:i.shipping.fullName}),d.jsx("p",{children:i.shipping.address}),(0,d.jsxs)("p",{children:[i.shipping.city,", ",i.shipping.state," ",i.shipping.zip]}),d.jsx("p",{children:i.shipping.country}),(0,d.jsxs)("p",{children:["Phone: ",i.shipping.phone]})]}),(0,d.jsxs)("div",{children:[d.jsx("h3",{children:"Payment Method"}),(0,d.jsxs)("p",{children:["Credit Card ending in ",i.payment.cardNumber.slice(-4)]}),(0,d.jsxs)("p",{children:["Expiration: ",i.payment.expiry]})]}),(0,d.jsxs)("div",{children:[d.jsx("h3",{children:"Order Items"}),i.items.map((e,t)=>(0,d.jsxs)("div",{children:[d.jsx("img",{src:e.product.image,alt:e.product.name,width:50}),d.jsx("p",{children:e.product.name}),(0,d.jsxs)("p",{children:["Quantity: ",e.quantity]}),(0,d.jsxs)("p",{children:["Price: $",e.product.price.toFixed(2)]}),(0,d.jsxs)("p",{children:["Subtotal: $",(e.product.price*e.quantity).toFixed(2)]})]},t))]}),(0,d.jsxs)("div",{children:[d.jsx("h3",{children:"Order Summary"}),(0,d.jsxs)("p",{children:["Subtotal: $",i.total.toFixed(2)]}),d.jsx("p",{children:"Shipping: Free"}),(0,d.jsxs)("p",{children:["Tax: $",(.08*i.total).toFixed(2)]}),(0,d.jsxs)("p",{children:["Total: $",(1.08*i.total).toFixed(2)]})]}),d.jsx("button",{onClick:()=>r("payment"),children:"Back to Payment"}),d.jsx("button",{onClick:()=>{let t=OrderManager.createOrder({items:i.items,shipping:i.shipping,payment:{cardName:i.payment.cardName,lastFour:i.payment.cardNumber.slice(-4),expiry:i.payment.expiry},total:1.08*i.total});CartManager.clearCart(),sessionStorage.setItem("lastOrderId",t.id),e.push("/order-confirmation")},children:"Place Order"})]})]})}let m=(0,s.l)(i,"default"),h=(0,s.l)(i,"getStaticProps"),x=(0,s.l)(i,"getStaticPaths"),g=(0,s.l)(i,"getServerSideProps"),y=(0,s.l)(i,"config"),S=(0,s.l)(i,"reportWebVitals"),j=(0,s.l)(i,"unstable_getStaticProps"),v=(0,s.l)(i,"unstable_getStaticPaths"),P=(0,s.l)(i,"unstable_getStaticParams"),b=(0,s.l)(i,"unstable_getServerProps"),f=(0,s.l)(i,"unstable_getServerSideProps"),_=new a.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/checkout",pathname:"/checkout",bundlePath:"",filename:""},components:{App:c.default,Document:p()},userland:i})},9597:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>MyApp});var i=r(997);r(4195),r(7109),r(3162),r(2533),r(9317),r(9398);var a=r(1649);function MyApp({Component:e,pageProps:{session:t,...r}}){return i.jsx(a.SessionProvider,{session:t,children:i.jsx(e,{...r})})}},7109:()=>{},2533:()=>{},4195:()=>{},3162:()=>{},9317:()=>{},9398:()=>{},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},7147:e=>{"use strict";e.exports=require("fs")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},9796:e=>{"use strict";e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[209,450,760,588,163],()=>__webpack_exec__(2962));module.exports=r})();